<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/jquery@latest/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@latest/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/styles.css">
    <script>
        function query() {
            console.log('query clicked')
            let role = $('#role').val()
            let country = $('#country').val()
            let language = $('#language').val()
            let salary = $('#salary').val()
            let acceptHeader = 'application/sparql-results+json'
            let url = 'https://jena.helmuth.at/jobsta/query?query='
            let qry_schema = 'PREFIX rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX group1:<http://www.semanticweb.org/sws/ws2019/group1#>\nPREFIX schema:<http://schema.org/>\nPREFIX dbpedia:<http://dbpedia.org/resource/>\nPREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#>\nPREFIX sc:<http://purl.org/science/owl/sciencecommons/>\nPREFIX xsd:<http://www.w3.org/2001/XMLSchema#>\n';
            let qry = `ASK
WHERE {
  ?developer a group1:Developer .
  ?developer schema:homeLocation ?country .
  ?developer group1:developsIn ?language .
  ?developer group1:hasRole ?role .
  {
    SELECT ?country (AVG(?avgRange) as ?averageK)
    WHERE {
        ?developer a group1:Developer .
        ?developer group1:hasRole ?role .
        ?developer schema:homeLocation ?country .
        ?developer group1:developsIn ?language .
      ?developer group1:hasSalaryRange ?salaryRange .
      ?salaryRange group1:minSalary ?minSalary .
      ?salaryRange group1:maxSalary ?maxSalary.
      BIND ((?minSalary + ?maxSalary)/2 AS ?avgRange)
    }
    GROUP BY ?country
  }
  {
    SELECT ?country (AVG(?salaryValue) as ?averageS)
    WHERE {
      ?developer a group1:Developer .
      ?developer group1:hasRole ?role .
      ?developer schema:homeLocation ?country .
      ?developer group1:developsIn ?language .
      ?developer group1:salary ?salaryValue .
    }
    GROUP BY ?country
  }
  BIND ((?averageK + ?averageS)/2 as ?average)
  FILTER (?language = ${language} && ?country = ${country} && ?average > "${salary}"^^xsd:integer && ?role = ${role})
}
GROUP BY ?country ?average`;
            
            $.get(url+encodeURIComponent(qry_schema + qry)).then(function (result) {
            // const result = JSON.parse(`{
            //                           "head": {
            //                             "vars": [ "name" , "programming_language" ]
            //                           } ,
            //                           "results": {
            //                             "bindings": [
            //                               {
            //                                 "name": { "type": "literal" , "value": "Advanced Methods for Regression and Classification" } ,
            //                                 "programming_language": { "type": "uri" , "value": "http://www.semanticweb.org/sws/ws2019/group1#R" }
            //                               } ,
            //                               {
            //                                 "name": { "type": "literal" , "value": "Statistical Computing" } ,
            //                                 "programming_language": { "type": "uri" , "value": "http://www.semanticweb.org/sws/ws2019/group1#R" }
            //                               } ,
            //                               {
            //                                 "name": { "type": "literal" , "value": "Machine Learning" } ,
            //                                 "programming_language": { "type": "uri" , "value": "http://www.semanticweb.org/sws/ws2019/group1#R" }
            //                               } ,
            //                               {
            //                                 "name": { "type": "literal" , "value": "Technology exploitation" } ,
            //                                 "programming_language": { "type": "uri" , "value": "http://www.semanticweb.org/sws/ws2019/group1#R" }
            //                               } 
            //                               ] 
            //                             } 
            //                           }`)
              if (result) {
                if (result.boolean == true) {
                  $('#Answer').html("You should stay!")
                } else {                
                  $('#Answer').html("You should go!")
                }
              }
            });
        }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-12 text-center">          
            <a href="index-bs.html" class="subtitle">
              <div class="jobsta-logo">
                <img src="img/jobsta-logo.png" />
                <div class="slogan">Study - Job - Money</div>
              </div>
            </a>          
        </div>
      </div>
        <div class="row">
        <div class="col-12 text-center">
          <h1 class="start-2 padding-05">Location</h1>
        </div>
        <div class="col-12 text-center query">
            As a <select id="role"><option value="group1:Data_Scientist">Data Scientist</option><option value="group1:Manager">Manager</option><option value="group1:Research_Scientist">Research Scientist</option><option value="group1:Software_Engineer">Software Engineer</option></select> I live in <select id="country"><option value="dbpedia:Austria">Austria</option><option value="dbpedia:Germany">Germany</option><option value="dbpedia:Japan">Japan</option><option value="dbpedia:United_Kingdom">United Kingdom</option><option value="dbpedia:United_States">United States</option></select><br/>
            and I can program in <select id="language"><option value="group1:Java">Java</option><option value="group1:Python">Python</option><option value="group1:SQL">SQL</option></select><br/>
            and I want at least <input id="salary" class="salary" type="number" value="55000"/>
        </div>
        <div class="col-12 text-center">
          <button class="btn-primary btn-my-primary margin-top1 query" onclick="query()">Query</button>
        </div>
        <div class="col-12 text-center">
            <h1 class="margin-top1">Answer</h1>
        </div>
        <div class="col-12 text-center">
            <div class="answer" id="Answer"></div>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/bootstrap@latest/dist/js/bootstrap.min.js"></script>
    
  </body>
</html>
